<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style-settings.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <h1>‚öôÔ∏è Configuration</h1>
                    <p class="subtitle">Param√®tres de l'application</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <a href="/nautiljon" class="btn" style="background: #667eea;">üåä Nautiljon</a>
                    <a href="/" class="btn-back">‚Üê Retour aux biblioth√®ques</a>
                </div>
            </div>
        </header>

        <div class="content">
            <!-- Navigation par onglets -->
            <div class="settings-tabs">
                <button class="tab-button active" data-tab="amule" onclick="switchTab('amule')">
                    üåê aMule / eMule
                </button>
                <button class="tab-button" data-tab="ebdz" onclick="switchTab('ebdz')">
                    üï∏Ô∏è ebdz.net
                </button>
                <button class="tab-button" data-tab="prowlarr" onclick="switchTab('prowlarr')">
                    üîç Prowlarr
                </button>
                <button class="tab-button" data-tab="qbittorrent" onclick="switchTab('qbittorrent')">
                    ‚ö° qBittorrent
                </button>
                <button class="tab-button" data-tab="monitoring" onclick="switchTab('monitoring')">
                    üìä Surveillance
                </button>
                <button class="tab-button" data-tab="badges" onclick="switchTab('badges')">
                    üé® Badges
                </button>
                <button class="tab-button" onclick="switchTab('general')" style="opacity: 0.5; cursor: not-allowed;" disabled>
                    üîß G√©n√©ral (bient√¥t)
                </button>
                <button class="tab-button" onclick="switchTab('notifications')" style="opacity: 0.5; cursor: not-allowed;" disabled>
                    üîî Notifications (bient√¥t)
                </button>
            </div>

            <!-- Contenu des onglets -->
            <div class="settings-content">
                <!-- Onglet aMule -->
                <div class="tab-content active" id="tab-amule">
                    <div class="settings-section">
                        <div class="section-header">
                            <h2>üåê Configuration aMule / eMule</h2>
                            <p class="section-description">
                                Configurez la connexion √† votre client aMule ou eMule pour ajouter automatiquement 
                                les t√©l√©chargements depuis l'interface.
                            </p>
                        </div>

                        <div class="settings-card">
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="emuleEnabled">
                                <label for="emuleEnabled">
                                    <strong>Activer l'int√©gration aMule/eMule</strong>
                                    <span class="help-text">Permet d'ajouter des liens ED2K directement depuis l'application</span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label for="emuleType">Type de client</label>
                                <select id="emuleType" class="form-select">
                                    <option value="amule">aMule (Linux/Mac)</option>
                                    <option value="emule">eMule (Windows)</option>
                                </select>
                                <small class="help-text">S√©lectionnez le client que vous utilisez</small>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="emuleHost">H√¥te</label>
                                    <input type="text" id="emuleHost" value="127.0.0.1" placeholder="127.0.0.1">
                                    <small class="help-text">Adresse IP du serveur aMule/eMule</small>
                                </div>

                                <div class="form-group">
                                    <label for="emuleEcPort">Port External Connections (EC)</label>
                                    <input type="number" id="emuleEcPort" value="4712" placeholder="4712">
                                    <small class="help-text">Port EC configur√© dans aMule (d√©faut: 4712)</small>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="emulePassword">Mot de passe EC</label>
                                <div class="password-input-group">
                                    <input type="password" id="emulePassword" placeholder="Mot de passe External Connections">
                                    <button type="button" class="btn-toggle-password" onclick="togglePassword()">
                                        üëÅÔ∏è Afficher
                                    </button>
                                </div>
                                <small class="help-text">Mot de passe configur√© dans les pr√©f√©rences EC d'aMule</small>
                            </div>

                            <div class="form-actions">
                                <button class="btn btn-success" onclick="saveSettings()">
                                    üíæ Enregistrer
                                </button>
                                <button class="btn" onclick="testConnection()">
                                    üîå Tester la connexion
                                </button>
                                <button class="btn" onclick="resetSettings()">
                                    üîÑ R√©initialiser
                                </button>
                            </div>

                            <div id="settingsMessage" class="message"></div>
                        </div>

                        <!-- Aide configuration -->
                        <div class="help-section">
                            <h3>üìñ Aide √† la configuration</h3>
                            
                            <details class="help-details">
                                <summary>Comment configurer aMule sur Linux ?</summary>
                                <div class="help-content">
                                    <ol>
                                        <li>Ouvrez aMule</li>
                                        <li>Allez dans <strong>Pr√©f√©rences > Connexions √† distance</strong></li>
                                        <li>Cochez <strong>"Activer les External Connections"</strong></li>
                                        <li>D√©finissez un mot de passe EC</li>
                                        <li>Notez le port (d√©faut: 4712)</li>
                                        <li>Installez amule-utils : <code>sudo apt install amule-utils</code></li>
                                        <li>Red√©marrez aMule</li>
                                    </ol>
                                </div>
                            </details>

                            <details class="help-details">
                                <summary>Comment configurer eMule sur Windows ?</summary>
                                <div class="help-content">
                                    <ol>
                                        <li>Ouvrez eMule</li>
                                        <li>Allez dans <strong>Options > Interface Web</strong></li>
                                        <li>Cochez <strong>"Activer le serveur web"</strong></li>
                                        <li>D√©finissez un mot de passe</li>
                                        <li>Notez le port (d√©faut: 4711)</li>
                                        <li>Red√©marrez eMule</li>
                                    </ol>
                                </div>
                            </details>

                            <details class="help-details">
                                <summary>La connexion √©choue, que faire ?</summary>
                                <div class="help-content">
                                    <ul>
                                        <li>‚úÖ V√©rifiez que aMule/eMule est bien d√©marr√©</li>
                                        <li>‚úÖ V√©rifiez le mot de passe EC</li>
                                        <li>‚úÖ V√©rifiez que le port EC est correct</li>
                                        <li>‚úÖ V√©rifiez que le pare-feu n'est pas bloquant</li>
                                        <li>‚úÖ Pour aMule : v√©rifiez que amule-utils est install√©</li>
                                        <li>‚úÖ Testez avec <code>amulecmd -h 127.0.0.1 -P votreMotDePasse -c status</code></li>
                                    </ul>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>

                <!-- Onglet ebdz.net -->
                <div class="tab-content" id="tab-ebdz">
                    <div class="settings-section">
                        <div class="section-header">
                            <h2>üï∏Ô∏è Configuration ebdz.net</h2>
                            <p class="section-description">
                                Configurez vos identifiants de connexion au forum et les forums √† scraper 
                                pour alimenter votre base de donn√©es ED2K.
                            </p>
                        </div>

                        <!-- Carte identifiants -->
                        <div class="settings-card">
                            <h3 style="margin-bottom: 20px; color: #333;">üîê Identifiants du forum</h3>

                            <div class="form-group">
                                <label for="ebdzUsername">Nom d'utilisateur</label>
                                <input type="text" id="ebdzUsername" placeholder="Votre pseudo sur ebdz.net">
                                <small class="help-text">Pseudo utilis√© pour vous connecter au forum</small>
                            </div>

                            <div class="form-group">
                                <label for="ebdzPassword">Mot de passe</label>
                                <div class="password-input-group">
                                    <input type="password" id="ebdzPassword" placeholder="Votre mot de passe">
                                    <button type="button" class="btn-toggle-password" onclick="toggleEbdzPassword()">
                                        üëÅÔ∏è Afficher
                                    </button>
                                </div>
                                <small class="help-text">Mot de passe du compte forum</small>
                            </div>

                            <div class="form-actions">
                                <button class="btn btn-success" onclick="saveEbdzConfig()">
                                    üíæ Enregistrer
                                </button>
                            </div>
                            <div id="ebdzMessage" class="message"></div>
                        </div>

                        <!-- Carte forums √† scraper -->
                        <div class="settings-card" style="margin-top: 30px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="color: #333; margin: 0;">üìÇ Forums √† scraper</h3>
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <label class="select-all-label" id="selectAllLabel" style="display:none;">
                                        <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll(this)">
                                        <span>Tout s√©lectionner</span>
                                    </label>
                                    <button class="btn btn-success" style="padding: 8px 18px; font-size: 0.9em;" onclick="addForumRow()">
                                        ‚ûï Ajouter un forum
                                    </button>
                                </div>
                            </div>

                            <div id="forumsList">
                                <!-- Les lignes de forums sont g√©r√©es par JS -->
                            </div>

                            <div id="forumsEmptyState" class="no-forums-placeholder">
                                <p>Aucun forum configur√©. Cliquez sur <strong>‚ûï Ajouter un forum</strong> pour en ajouter un.</p>
                            </div>

                            <div class="form-actions" style="margin-top: 25px;">
                                <button class="btn btn-success" onclick="saveEbdzConfig()">
                                    üíæ Enregistrer tout
                                </button>
                                <button class="btn" onclick="runScraper()" id="btnRunScraper">
                                    üöÄ Lancer le scraper
                                </button>
                            </div>
                            <div id="ebdzMessage2" class="message"></div>
                        </div>

                        <!-- Carte scraping automatique -->
                        <div class="settings-card" style="margin-top: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <span style="font-size: 24px;">‚è∞</span>
                                <h3 style="color: white; margin: 0;">Scraping automatique</h3>
                            </div>

                            <div class="form-group checkbox-group" style="margin-bottom: 20px;">
                                <input type="checkbox" id="ebdzAutoScrapeEnabled">
                                <label for="ebdzAutoScrapeEnabled" style="color: white;">
                                    <strong>Activer le scraping automatique</strong>
                                    <span class="help-text" style="color: rgba(255,255,255,0.85);">Le forum sera scrapy automatiquement √† intervalle r√©gulier</span>
                                </label>
                            </div>

                            <div class="form-row" id="autoScrapeControlsDiv" style="display: none;">
                                <div class="form-group" style="flex: 1;">
                                    <label for="ebdzAutoScrapeInterval" style="color: white;">Intervalle</label>
                                    <input type="number" id="ebdzAutoScrapeInterval" value="60" min="1" placeholder="60" style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: white;">
                                    <small class="help-text" style="color: rgba(255,255,255,0.85);">Temps avant le prochain scraping</small>
                                </div>

                                <div class="form-group" style="flex: 1;">
                                    <label for="ebdzAutoScrapeUnit" style="color: white;">Unit√©</label>
                                    <select id="ebdzAutoScrapeUnit" style="background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: white;">
                                        <option value="minutes" style="background: #333; color: white;">Minutes</option>
                                        <option value="hours" style="background: #333; color: white;">Heures</option>
                                        <option value="days" style="background: #333; color: white;">Jours</option>
                                    </select>
                                    <small class="help-text" style="color: rgba(255,255,255,0.85);">Unit√© de temps de l'intervalle</small>
                                </div>
                            </div>

                            <div id="autoScrapeStatusDiv" style="display: none; margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 5px; border-left: 3px solid #4CAF50;">
                                <p style="margin: 0 0 5px 0; color: white;">
                                    <strong>Statut:</strong> <span id="autoScrapeStatusText">En attente...</span>
                                </p>
                                <p style="margin: 0; color: rgba(255,255,255,0.9);">
                                    <strong>Prochain scraping:</strong> <span id="autoScrapeNextRunText">-</span>
                                </p>
                            </div>

                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn" onclick="saveAutoScrapeConfig()" style="background: white; color: #667eea; border: none;">
                                    üíæ Enregistrer la config automatique
                                </button>
                                <button class="btn" onclick="checkAutoScrapeStatus()" id="btnCheckAutoStatus" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;">
                                    üîÑ V√©rifier le statut
                                </button>
                            </div>
                            <div id="ebdzAutoMessage" class="message"></div>
                        </div>

                        <!-- Aide -->
                        <div class="help-section">
                            <h3>üìñ Aide</h3>
                            <details class="help-details">
                                <summary>O√π trouver le code du forum (fid) ?</summary>
                                <div class="help-content">
                                    <ol>
                                        <li>Rendez-vous sur <strong>ebdz.net/forum</strong></li>
                                        <li>Ouvrez la cat√©gorie qui vous int√©resse (ex : Mangas, Films‚Ä¶)</li>
                                        <li>Dans l'URL du navigateur, vous verrez un param√®tre comme <code>fid=29</code></li>
                                        <li>C'est ce nombre qu'il faut entrer dans le champ <strong>Code du forum (fid)</strong></li>
                                    </ol>
                                </div>
                            </details>
                            <details class="help-details">
                                <summary>Qu'est-ce que "max pages" ?</summary>
                                <div class="help-content">
                                    <p>Le scraper parcourt les threads page par page. <strong>Max pages</strong> permet de limiter le nombre de pages scann√©es. Laissez le champ vide pour scraper tout le forum sans limite.</p>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>

                <!-- Onglet Prowlarr -->
                <div class="tab-content" id="tab-prowlarr">
                    <div class="settings-section">
                        <div class="section-header">
                            <h2>üîç Configuration Prowlarr</h2>
                            <p class="section-description">
                                Configurez la connexion √† votre serveur Prowlarr pour int√©grer les indexeurs 
                                et am√©liorer vos recherches de contenu.
                            </p>
                        </div>

                        <div class="settings-card">
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="prowlarrEnabled">
                                <label for="prowlarrEnabled">
                                    <strong>Activer l'int√©gration Prowlarr</strong>
                                    <span class="help-text">Permet d'utiliser les indexeurs Prowlarr dans l'application</span>
                                </label>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="prowlarrUrl">URL du serveur</label>
                                    <input type="text" id="prowlarrUrl" placeholder="http://localhost:9696 ou http://192.168.1.100:9696">
                                    <small class="help-text">Adresse compl√®te du serveur Prowlarr (avec http:// ou https://)</small>
                                </div>

                                <div class="form-group">
                                    <label for="prowlarrPort">Port</label>
                                    <input type="number" id="prowlarrPort" value="9696" placeholder="9696">
                                    <small class="help-text">Port d'acc√®s √† Prowlarr (d√©faut: 9696)</small>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="prowlarrApiKey">Cl√© API</label>
                                <div class="password-input-group">
                                    <input type="password" id="prowlarrApiKey" placeholder="Votre cl√© API Prowlarr">
                                    <button type="button" class="btn-toggle-password" onclick="toggleProwlarrPassword()">
                                        üëÅÔ∏è Afficher
                                    </button>
                                </div>
                                <small class="help-text">Cl√© API disponible dans les param√®tres Prowlarr > Param√®tres > G√©n√©ral > S√©curit√©</small>
                            </div>

                            <div class="form-actions">
                                <button class="btn btn-success" onclick="saveProwlarrSettings()">
                                    üíæ Enregistrer
                                </button>
                                <button class="btn" onclick="testProwlarrConnection()">
                                    üîå Tester la connexion
                                </button>
                                <button class="btn" onclick="resetProwlarrSettings()">
                                    üîÑ R√©initialiser
                                </button>
                            </div>

                            <div id="prowlarrMessage" class="message"></div>
                        </div>

                        <!-- S√©lection des indexeurs -->
                        <div class="settings-card" style="margin-top: 30px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3 style="color: #333; margin: 0;">üîé Indexeurs √† utiliser</h3>
                                <button class="btn btn-success" style="padding: 8px 18px; font-size: 0.9em;" onclick="loadProwlarrIndexers()">
                                    üì• R√©cup√©rer les indexeurs
                                </button>
                            </div>

                            <div id="indexersList" style="margin-bottom: 15px;">
                                <p style="color: #999;">Cliquez sur "R√©cup√©rer les indexeurs" pour charger la liste depuis Prowlarr</p>
                            </div>

                            <div class="form-actions">
                                <button class="btn btn-success" onclick="saveProwlarrIndexers()">
                                    üíæ Enregistrer la s√©lection
                                </button>
                            </div>
                            <div id="indexersMessage" class="message"></div>
                        </div>

                        <!-- Aide configuration -->
                        <div class="help-section">
                            <h3>üìñ Aide √† la configuration</h3>
                            
                            <details class="help-details">
                                <summary>O√π trouver ma cl√© API Prowlarr ?</summary>
                                <div class="help-content">
                                    <ol>
                                        <li>Ouvrez Prowlarr dans votre navigateur</li>
                                        <li>Allez dans <strong>Param√®tres (‚öôÔ∏è) > G√©n√©ral</strong></li>
                                        <li>Faites d√©filer jusqu'√† <strong>S√©curit√©</strong></li>
                                        <li>Vous trouvez le champ <strong>Cl√© API</strong></li>
                                        <li>Copiez la cl√© et collez-la dans le formulaire ci-dessus</li>
                                    </ol>
                                </div>
                            </details>

                            <details class="help-details">
                                <summary>Comment acc√©der √† Prowlarr depuis une autre machine ?</summary>
                                <div class="help-content">
                                    <ul>
                                        <li>Si Prowlarr est sur la m√™me machine : <code>http://127.0.0.1:9696</code></li>
                                        <li>Si Prowlarr est sur une autre machine du r√©seau : <code>http://192.168.1.100:9696</code> (remplacez par l'IP)</li>
                                        <li>Assurez-vous que le port 9696 (ou celui configur√©) est accessible</li>
                                        <li>En HTTPS, utilisez <code>https://</code> au lieu de <code>http://</code></li>
                                    </ul>
                                </div>
                            </details>

                            <details class="help-details">
                                <summary>La connexion √©choue, que faire ?</summary>
                                <div class="help-content">
                                    <ul>
                                        <li>‚úÖ V√©rifiez que Prowlarr est bien d√©marr√©</li>
                                        <li>‚úÖ V√©rifiez que l'URL est correcte (avec http:// ou https://)</li>
                                        <li>‚úÖ V√©rifiez que la cl√© API est correcte</li>
                                        <li>‚úÖ V√©rifiez que le port est accessible (pare-feu)</li>
                                        <li>‚úÖ Essayez d'acc√©der √† Prowlarr dans votre navigateur pour v√©rifier que √ßa fonctionne</li>
                                    </ul>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>

                <!-- Onglet qBittorrent -->
                <div class="tab-content" id="tab-qbittorrent">
                    <div class="settings-section">
                        <div class="section-header">
                            <h2>‚ö° Configuration qBittorrent</h2>
                            <p class="section-description">
                                Configurez la connexion √† votre serveur qBittorrent pour ajouter automatiquement 
                                les torrents depuis l'interface.
                            </p>
                        </div>

                        <div class="settings-card">
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="qbittorrentEnabled">
                                <label for="qbittorrentEnabled">
                                    <strong>Activer l'int√©gration qBittorrent</strong>
                                    <span class="help-text">Permet d'ajouter des torrents directement depuis l'application</span>
                                </label>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="qbittorrentUrl">URL du serveur</label>
                                    <input type="text" id="qbittorrentUrl" placeholder="http://localhost">
                                    <small class="help-text">Adresse du serveur qBittorrent (sans :port ni http://stream)</small>
                                </div>

                                <div class="form-group">
                                    <label for="qbittorrentPort">Port</label>
                                    <input type="number" id="qbittorrentPort" value="8080" placeholder="8080">
                                    <small class="help-text">Port du Web UI de qBittorrent (d√©faut: 8080)</small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="qbittorrentUsername">Nom d'utilisateur</label>
                                    <input type="text" id="qbittorrentUsername" placeholder="Optionnel">
                                    <small class="help-text">Nom d'utilisateur du Web UI (optionnel)</small>
                                </div>

                                <div class="form-group">
                                    <label for="qbittorrentPassword">Mot de passe</label>
                                    <div class="password-input-group">
                                        <input type="password" id="qbittorrentPassword" placeholder="Optionnel">
                                        <button type="button" class="btn-toggle-password" onclick="toggleQbittorrentPassword()">
                                            üëÅÔ∏è Afficher
                                        </button>
                                    </div>
                                    <small class="help-text">Mot de passe du Web UI (optionnel)</small>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="qbittorrentDefaultCategory">Cat√©gorie par d√©faut (optionnel)</label>
                                    <select id="qbittorrentDefaultCategory" style="
                                        width: 100%;
                                        padding: 10px;
                                        border: 1px solid #ddd;
                                        border-radius: 5px;
                                        font-size: 1em;
                                    ">
                                        <option value="">-- Aucune cat√©gorie --</option>
                                    </select>
                                    <small class="help-text">La cat√©gorie utilis√©e par d√©faut pour les torrents ajout√©s (charg√©e depuis qBittorrent)</small>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button class="btn btn-success" onclick="saveQbittorrentSettings()">
                                    üíæ Enregistrer
                                </button>
                                <button class="btn" onclick="testQbittorrentConnection()">
                                    üîå Tester la connexion
                                </button>
                                <button class="btn" onclick="resetQbittorrentSettings()">
                                    üîÑ R√©initialiser
                                </button>
                            </div>

                            <div id="qbittorrentMessage" class="message"></div>
                        </div>

                        <!-- Aide configuration -->
                        <div class="help-section">
                            <h3>üìñ Aide √† la configuration</h3>
                            
                            <details class="help-details">
                                <summary>Comment acc√©der au Web UI de qBittorrent ?</summary>
                                <div class="help-content">
                                    <ol>
                                        <li>Ouvrez qBittorrent sur votre ordinateur ou serveur</li>
                                        <li>Allez dans <strong>Outils > Options</strong></li>
                                        <li>S√©lectionnez <strong>Web UI</strong> dans le menu de gauche</li>
                                        <li>Cochez <strong>"Activer le serveur Web"</strong></li>
                                        <li>Notez le <strong>Port</strong> (d√©faut: 8080)</li>
                                        <li>D√©finissez un nom d'utilisateur et un mot de passe si souhait√©</li>
                                        <li>Cliquez OK et red√©marrez qBittorrent</li>
                                    </ol>
                                </div>
                            </details>

                            <details class="help-details">
                                <summary>Comment acc√©der √† qBittorrent depuis une autre machine ?</summary>
                                <div class="help-content">
                                    <ul>
                                        <li>Si qBittorrent est sur la m√™me machine : <code>http://localhost:8080</code> ou <code>http://127.0.0.1:8080</code></li>
                                        <li>Si qBittorrent est sur une autre machine du r√©seau : <code>http://192.168.1.100:8080</code> (remplacez par l'IP)</li>
                                        <li>Assurez-vous que le port est accessible (pare-feu)</li>
                                        <li>En HTTPS, utilisez <code>https://</code> au lieu de <code>http://</code></li>
                                    </ul>
                                </div>
                            </details>

                            <details class="help-details">
                                <summary>La connexion √©choue, que faire ?</summary>
                                <div class="help-content">
                                    <ul>
                                        <li>‚úÖ V√©rifiez que qBittorrent est bien d√©marr√©</li>
                                        <li>‚úÖ V√©rifiez que le Web UI est activ√© dans les options</li>
                                        <li>‚úÖ V√©rifiez que l'URL et le port sont corrects</li>
                                        <li>‚úÖ V√©rifiez les identifiants (si configur√©s)</li>
                                        <li>‚úÖ V√©rifiez que le port est accessible (pare-feu)</li>
                                        <li>‚úÖ Essayez d'acc√©der au Web UI dans votre navigateur pour v√©rifier</li>
                                    </ul>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>

                <!-- Onglet Badges -->
                <div class="tab-content" id="tab-badges">
                    <div class="settings-section">
                        <div class="section-header">
                            <h2>üé® Configuration des Badges</h2>
                            <p class="section-description">
                                Personnalisez les couleurs des badges d'√©tat des s√©ries
                            </p>
                        </div>

                        <div class="settings-card">
                            <div class="badge-config-grid">
                                <!-- Badge Finie (Vert) -->
                                <div class="badge-config-item">
                                    <div class="badge-label">
                                        <strong>‚úÖ Finie</strong>
                                        <small>S√©rie complete (volumes locaux = Nautiljon) et termin√©e sur Nautiljon</small>
                                    </div>
                                    <div class="color-picker-group">
                                        <input type="color" id="badgeColorComplete" value="#10b981">
                                        <input type="text" id="badgeColorCompleteText" class="color-text" readonly>
                                    </div>
                                </div>

                                <!-- Badge En Cours (Rouge) -->
                                <div class="badge-config-item">
                                    <div class="badge-label">
                                        <strong>üîÑ En cours</strong>
                                        <small>Volumes ne correspondent pas ou s√©rie en cours sur Nautiljon</small>
                                    </div>
                                    <div class="color-picker-group">
                                        <input type="color" id="badgeColorOngoing" value="#ef4444">
                                        <input type="text" id="badgeColorOngoingText" class="color-text" readonly>
                                    </div>
                                </div>

                                <!-- Badge Incomplet (Orange) -->
                                <div class="badge-config-item">
                                    <div class="badge-label">
                                        <strong>‚ö†Ô∏è Incomplet</strong>
                                        <small>Volumes manquants, s√©rie pas termin√©e</small>
                                    </div>
                                    <div class="color-picker-group">
                                        <input type="color" id="badgeColorIncomplete" value="#f59e0b">
                                        <input type="text" id="badgeColorIncompleteText" class="color-text" readonly>
                                    </div>
                                </div>

                                <!-- Badge Manquant (Bleu) -->
                                <div class="badge-config-item">
                                    <div class="badge-label">
                                        <strong>üìö Manquant</strong>
                                        <small>S√©rie termin√©e, volumes manquants</small>
                                    </div>
                                    <div class="color-picker-group">
                                        <input type="color" id="badgeColorMissing" value="#3b82f6">
                                        <input type="text" id="badgeColorMissingText" class="color-text" readonly>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 20px;">
                                <button class="btn" onclick="saveBadgeColors()" style="background: #10b981;">
                                    üíæ Sauvegarder les couleurs
                                </button>
                                <button class="btn" onclick="resetBadgeColors()" style="background: #6b7280; margin-left: 10px;">
                                    üîÑ R√©initialiser aux d√©fauts
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Onglet Surveillance -->
                <div class="tab-content" id="tab-monitoring">
                    <div class="settings-section">
                        <div class="section-header">
                            <h2>üìä Surveillance des Volumes</h2>
                            <p class="section-description">
                                Configurez la surveillance automatique des volumes manquants et nouveaux volumes
                            </p>
                        </div>

                        <!-- Surveillance des Volumes Manquants -->
                        <div class="settings-card">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <span style="font-size: 24px;">‚ö†Ô∏è</span>
                                <h3 style="margin: 0; color: #333;">Volumes Manquants</h3>
                            </div>

                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="settingsMonitorMissing" checked>
                                <label for="settingsMonitorMissing">
                                    <strong>Activer la surveillance des volumes manquants</strong>
                                    <span class="help-text">D√©tecte automatiquement les volumes manquants dans vos s√©ries</span>
                                </label>
                            </div>

                            <div id="missingVolumesSettings" style="padding-left: 20px;">
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="settingsMissingSearch" checked>
                                    <label for="settingsMissingSearch">
                                        <strong>Recherche automatique</strong>
                                        <span class="help-text">Recherche les volumes manquants</span>
                                    </label>
                                </div>

                                <!-- Priorisation des sources -->
                                <div class="form-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">üéØ Priorisation des sources</label>
                                    <small class="help-text" style="display: block; margin-bottom: 15px;">Choisissez l'ordre pour afficher les r√©sultats de recherche</small>
                                    
                                    <div id="missingSourcesTooltip" style="background: #f0f4ff; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                                        <div style="font-size: 13px; color: #555; line-height: 1.6;">
                                            <div style="margin-bottom: 8px;">
                                                <strong style="color: #333;">üìå Source 1√®re (priority)</strong><br>
                                                <span id="missingSources1st" style="background: #e3f2fd; padding: 4px 8px; border-radius: 3px; display: inline-block; margin-top: 4px;">-</span>
                                            </div>
                                            <div>
                                                <strong style="color: #333;">üìå Source 2nde</strong><br>
                                                <span id="missingSources2nd" style="background: #f5f5f5; padding: 4px 8px; border-radius: 3px; display: inline-block; margin-top: 4px;">-</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: flex; gap: 8px;">
                                        <button class="btn" onclick="swapMissingSources()" style="flex: 1; background: #ff9800;">
                                            üîÑ Inverser l'ordre
                                        </button>
                                    </div>
                                </div>

                                <div id="missingSources" style="padding-left: 30px; margin-bottom: 15px; margin-top: 15px;">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">Sources activ√©es</label>
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="settingsMissingEbdz" checked>
                                        <label for="settingsMissingEbdz">EBDZ</label>
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="settingsMissingProwlarr" checked>
                                        <label for="settingsMissingProwlarr">Prowlarr</label>
                                    </div>
                                </div>

                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="settingsMissingAutoDownload">
                                    <label for="settingsMissingAutoDownload">
                                        <strong>T√©l√©chargement automatique</strong>
                                        <span class="help-text">Envoie automatiquement au client les volumes trouv√©s</span>
                                    </label>
                                </div>

                                <!-- Fr√©quence de v√©rification -->
                                <div class="form-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">Fr√©quence de v√©rification</label>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="missingCheckInterval">Intervalle</label>
                                            <input type="number" id="missingCheckInterval" value="1" min="1" max="999" placeholder="1" onchange="updateNextMissingCheck()" onkeyup="updateNextMissingCheck()">
                                        </div>
                                        <div class="form-group">
                                            <label for="missingCheckUnit">Unit√©</label>
                                            <select id="missingCheckUnit" class="form-select" onchange="updateNextMissingCheck()">
                                                <option value="hours">Heures</option>
                                                <option value="days">Jours</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="nextMissingCheck" style="margin-top: 10px; padding: 10px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 3px; color: #2e7d32; font-size: 14px;">
                                        Prochaine v√©rification: -
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn btn-success" onclick="saveMonitoringConfig()">
                                    üíæ Sauvegarder
                                </button>
                                <a href="/missing-monitor" class="btn" style="background: #667eea;">
                                    üìä Aller √† la surveillance
                                </a>
                            </div>
                        </div>

                        <!-- Surveillance des Nouveaux Volumes -->
                        <div class="settings-card" style="margin-top: 30px;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                <span style="font-size: 24px;">‚ú®</span>
                                <h3 style="margin: 0; color: #333;">Nouveaux Volumes</h3>
                            </div>

                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="settingsMonitorNew">
                                <label for="settingsMonitorNew">
                                    <strong>Activer la surveillance des nouveaux volumes</strong>
                                    <span class="help-text">D√©tecte automatiquement les nouveaux volumes publi√©s de vos s√©ries</span>
                                </label>
                            </div>

                            <div id="newVolumesSettings" style="padding-left: 20px; display: none;">
                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="settingsNewSearch" checked>
                                    <label for="settingsNewSearch">
                                        <strong>Recherche automatique</strong>
                                        <span class="help-text">Recherche les nouveaux volumes</span>
                                    </label>
                                </div>

                                <!-- Priorisation des sources -->
                                <div class="form-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">üéØ Priorisation des sources</label>
                                    <small class="help-text" style="display: block; margin-bottom: 15px;">Choisissez l'ordre pour afficher les r√©sultats de recherche</small>
                                    
                                    <div id="newSourcesTooltip" style="background: #f0f4ff; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                                        <div style="font-size: 13px; color: #555; line-height: 1.6;">
                                            <div style="margin-bottom: 8px;">
                                                <strong style="color: #333;">üìå Source 1√®re (priority)</strong><br>
                                                <span id="newSources1st" style="background: #e3f2fd; padding: 4px 8px; border-radius: 3px; display: inline-block; margin-top: 4px;">-</span>
                                            </div>
                                            <div>
                                                <strong style="color: #333;">üìå Source 2nde</strong><br>
                                                <span id="newSources2nd" style="background: #f5f5f5; padding: 4px 8px; border-radius: 3px; display: inline-block; margin-top: 4px;">-</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: flex; gap: 8px;">
                                        <button class="btn" onclick="swapNewSources()" style="flex: 1; background: #ff9800;">
                                            üîÑ Inverser l'ordre
                                        </button>
                                    </div>
                                </div>

                                <div id="newSources" style="padding-left: 30px; margin-bottom: 15px; margin-top: 15px;">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">Sources activ√©es</label>
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="settingsNewEbdz" checked>
                                        <label for="settingsNewEbdz">EBDZ</label>
                                    </div>
                                    <div class="form-group checkbox-group">
                                        <input type="checkbox" id="settingsNewProwlarr" checked>
                                        <label for="settingsNewProwlarr">Prowlarr</label>
                                    </div>
                                </div>

                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="settingsNewAutoDownload">
                                    <label for="settingsNewAutoDownload">
                                        <strong>T√©l√©chargement automatique</strong>
                                        <span class="help-text">Envoie automatiquement au client les nouveaux volumes trouv√©s</span>
                                    </label>
                                </div>

                                <div class="form-group checkbox-group">
                                    <input type="checkbox" id="settingsNautiljonCheck" checked>
                                    <label for="settingsNautiljonCheck">
                                        <strong>V√©rifier Nautiljon</strong>
                                        <span class="help-text">Utilise Nautiljon pour d√©tecter les nouveaux volumes</span>
                                    </label>
                                </div>

                                <!-- Fr√©quence de v√©rification -->
                                <div class="form-group" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">Fr√©quence de v√©rification</label>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="newCheckInterval">Intervalle</label>
                                            <input type="number" id="newCheckInterval" value="1" min="1" max="999" placeholder="1" onchange="updateNextNewCheck()" onkeyup="updateNextNewCheck()">
                                        </div>
                                        <div class="form-group">
                                            <label for="newCheckUnit">Unit√©</label>
                                            <select id="newCheckUnit" class="form-select" onchange="updateNextNewCheck()">
                                                <option value="hours">Heures</option>
                                                <option value="days">Jours</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="nextNewCheck" style="margin-top: 10px; padding: 10px; background: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 3px; color: #2e7d32; font-size: 14px;">
                                        Prochaine v√©rification: -
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions" style="margin-top: 20px;">
                                <button class="btn btn-success" onclick="saveMonitoringConfig()">
                                    üíæ Sauvegarder
                                </button>
                                <a href="/missing-monitor" class="btn" style="background: #667eea;">
                                    üìä Aller √† la surveillance
                                </a>
                            </div>
                        </div>

                        <div id="monitoringMessage" class="message" style="margin-top: 20px;"></div>
                    </div>
                </div>

                
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/settings.js') }}"></script>
</body>
</html>
