<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import de Mangas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <h1>üì• Import de Mangas</h1>
                    <p class="subtitle">Scannez et importez vos nouveaux mangas</p>
                </div>
                <a href="/" class="btn-back">‚Üê Retour aux biblioth√®ques</a>
            </div>
        </header>

        <div class="content">
            <!-- S√©lection du r√©pertoire d'import -->
            <div class="import-section">
                <h2>R√©pertoire d'import</h2>
                <div class="import-path-selector">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="import-path" class="import-path-input" 
                               placeholder="/chemin/vers/dossier/import">
                        <button type="button" class="btn btn-success" onclick="scanImportDirectory()">üîç Scanner</button>
                    </div>
                    <input type="file" id="import-folder-browser" webkitdirectory directory multiple 
                           style="display: none;" onchange="handleImportFolderSelect(event)">
                    <small style="color: #666; margin-top: 8px; display: block;">üí° Le chemin est automatiquement m√©moris√© pour la prochaine fois</small>
                </div>
            </div>

            <!-- Zone de r√©sultats du scan -->
            <div id="scan-results" style="display: none;">
                <div class="import-stats">
                    <div class="stat-card">
                        <div class="stat-label">Fichiers trouv√©s</div>
                        <div class="stat-value" id="files-found">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Correspondances</div>
                        <div class="stat-value" id="matches-found">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Non assign√©s</div>
                        <div class="stat-value" id="unassigned-count">0</div>
                    </div>
                </div>

                <!-- Actions globales -->
                <div class="import-actions">
                    <button class="btn" onclick="autoMatchAll()">üéØ Auto-assignation</button>
                    <button class="btn" onclick="cleanupEmptyDirectories()" style="background: #f59e0b;">üßπ Nettoyer r√©pertoires vides</button>
                    <button class="btn btn-success" onclick="executeImport()" id="import-btn" disabled>
                        ‚úÖ Importer les fichiers s√©lectionn√©s
                    </button>
                    <button class="btn" onclick="clearImport()">üóëÔ∏è Effacer</button>
                </div>

                <!-- Liste des fichiers √† importer -->
                <div id="import-files-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Scan en cours...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de s√©lection de s√©rie/biblioth√®que -->
    <div class="modal" id="select-destination-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeDestinationModal()">√ó</span>
            <h2 class="modal-title">S√©lectionner la destination</h2>
            <p class="modal-subtitle" id="file-to-assign">Fichier: ...</p>
            
            <div class="destination-selector">
                <div class="form-group">
                    <label>Biblioth√®que</label>
                    <select id="destination-library" onchange="loadLibrarySeries()">
                        <option value="">-- S√©lectionner une biblioth√®que --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>S√©rie</label>
                    <select id="destination-series">
                        <option value="">-- S√©lectionner une s√©rie --</option>
                        <option value="__new__">‚ûï Cr√©er une nouvelle s√©rie</option>
                    </select>
                </div>

                <div class="form-group" id="new-series-name-group" style="display: none;">
                    <label>Nom de la nouvelle s√©rie</label>
                    <input type="text" id="new-series-name" placeholder="Nom de la s√©rie">
                </div>

                <div class="form-actions">
                    <button class="btn" onclick="closeDestinationModal()">Annuler</button>
                    <button class="btn btn-success" onclick="assignDestination()">Valider</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/import.js') }}"></script>
</body>
</html>
