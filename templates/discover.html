<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DÃ©couvrir et ajouter des sÃ©ries</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style-discover.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Navigation verticale -->
        <div class="sidebar-nav">
            <a href="/" class="nav-link">ğŸ“š BibliothÃ¨ques</a>
            <a href="/import" class="nav-link">ğŸ“¥ Import</a>
            <a href="/discover" class="nav-link active">ğŸ¯ DÃ©couvrir</a>
            <a href="/search" class="nav-link">ğŸ” Recherche</a>
            <a href="/transfer" class="nav-link">â†”ï¸ Transfer</a>
            <a href="/nautiljon" class="nav-link">ğŸŒŠ Nautiljon</a>
            <a href="/missing-monitor" class="nav-link">ğŸ“Š Surveillance</a>
            <a href="/settings" class="nav-link">âš™ï¸ Configuration</a>
        </div>

        <div class="main-wrapper">
            <header>
                <div class="header-content">
                    <div class="header-left">
                        <h1>ğŸ¯ DÃ©couvrir et ajouter des sÃ©ries</h1>
                        <p class="subtitle">Cherchez, sÃ©lectionnez une bibliothÃ¨que, puis trouvez des sources</p>
                    </div>
                </div>
            </header>

            <div class="content-wrapper">
                <div class="content">
            <!-- Ã‰TAPE 1: Recherche sur Nautiljon -->
            <section class="step" id="step-1">
                <div class="step-header">
                    <h2>ğŸ“– Ã‰tape 1: Rechercher une sÃ©rie</h2>
                </div>
                
                <div class="search-box">
                    <input 
                        type="text" 
                        id="seriesNameInput" 
                        class="search-input" 
                        placeholder="Entrez le nom d'une sÃ©rie..."
                        onkeypress="if(event.key === 'Enter') searchNautiljon()"
                    >
                    <button class="btn-primary" onclick="searchNautiljon()">ğŸ” Chercher sur Nautiljon</button>
                </div>

                <div id="nautiljon-loading" class="loading" style="display:none;">
                    Recherche en cours sur Nautiljon...
                </div>

                <div id="nautiljon-results" class="results-box" style="display:none;">
                    <div class="results-header">
                        <h3>RÃ©sultats trouvÃ©s</h3>
                        <span id="results-count" class="results-count"></span>
                    </div>
                    <div id="results-list" class="results-list"></div>
                </div>

                <div id="nautiljon-error" class="error-box" style="display:none;"></div>
            </section>

            <!-- Ã‰TAPE 2: SÃ©lectionner une sÃ©rie et une bibliothÃ¨que -->
            <section class="step" id="step-2" style="display:none;">
                <div class="step-header">
                    <h2>ğŸ“š Ã‰tape 2: Choisir une bibliothÃ¨que</h2>
                    <button class="btn-secondary" onclick="resetToStep1()">Changer de sÃ©rie</button>
                </div>

                <div class="selection-info">
                    <div class="selected-series">
                        <h3>SÃ©rie sÃ©lectionnÃ©e</h3>
                        <div id="selected-series-display" class="series-display"></div>
                    </div>

                    <div class="library-selection">
                        <h3>Choisir une bibliothÃ¨que</h3>
                        <div id="libraries-list" class="libraries-list"></div>
                    </div>
                </div>

                <div id="library-loading" class="loading" style="display:none;">
                    Chargement des bibliothÃ¨ques...
                </div>

                <div id="series-verification-loading" class="loading" style="display:none;">
                    ğŸ“ VÃ©rification de la sÃ©rie...
                </div>

                <div id="library-error" class="error-box" style="display:none;"></div>
            </section>

            <!-- Ã‰TAPE 3: Recherche dans les sources (EBDZ + Prowlarr) -->
            <section class="step" id="step-3" style="display:none;">
                <div class="step-header">
                    <h2>ğŸ”— Ã‰tape 3: Chercher les sources</h2>
                    <button class="btn-secondary" onclick="resetToStep2()">Changer de bibliothÃ¨que</button>
                </div>

                <div class="sources-info">
                    <div class="selected-summary">
                        <h3>RÃ©sumÃ©</h3>
                        <div id="selection-summary" class="summary-box"></div>
                    </div>

                    <div class="sources-search">
                        <h3>Recherche dans les sources</h3>
                        <div class="source-controls">
                            <label>
                                <input type="checkbox" id="search-ebdz" checked> EBDZ (EdZ)
                            </label>
                            <label>
                                <input type="checkbox" id="search-prowlarr" checked> Prowlarr
                            </label>
                            <input 
                                type="number" 
                                id="volume-override" 
                                min="1"
                                placeholder="NumÃ©ro de volume (optionnel)"
                                class="volume-input"
                            >
                            <button class="btn-primary" onclick="searchSources()">ğŸ” Chercher les sources</button>
                        </div>
                    </div>
                </div>

                <div id="sources-loading" class="loading" style="display:none;">
                    Recherche en cours...
                </div>

                <div id="sources-results" class="results-box" style="display:none;">
                    <div class="results-header">
                        <h3>RÃ©sultats des sources</h3>
                    </div>
                    
                    <div id="ebdz-results" class="source-results" style="display:none;">
                        <h4>ğŸ“” RÃ©sultats EBDZ</h4>
                        <div id="ebdz-list" class="results-list"></div>
                    </div>

                    <div id="prowlarr-results" class="source-results" style="display:none;">
                        <h4>ğŸ” RÃ©sultats Prowlarr</h4>
                        <div id="prowlarr-list" class="results-list"></div>
                    </div>
                </div>

                <div id="sources-error" class="error-box" style="display:none;"></div>
            </section>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/search.js') }}"></script>
    <script src="{{ url_for('static', filename='js/discover.js') }}"></script>
    <script src="{{ url_for('static', filename='js/nav.js') }}"></script>
</body>
</html>
