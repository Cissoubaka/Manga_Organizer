<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nautiljon Integration Example - Manga Organizer</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/style-nautiljon.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 40px;
        }
        .section h2 {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .code {
            background: #f3f4f6;
            border-left: 4px solid #667eea;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåä Nautiljon Integration Examples</h1>
        <p>This page demonstrates how to integrate Nautiljon data into your Manga Organizer interface.</p>
    </div>

    <!-- Example 1: Search Widget -->
    <div class="container section">
        <h2>üìù Example 1: Nautiljon Search Widget</h2>
        <p>A simple search widget to find manga on Nautiljon:</p>
        
        <div class="nautiljon-search-widget">
            <label for="manga-search">üîç Search Manga on Nautiljon:</label>
            <input type="text" id="manga-search" placeholder="Enter manga title..." value="One Piece">
            <button onclick="exampleSearch()">Search</button>
            <div id="search-results"></div>
        </div>

        <div class="code" style="margin-top: 15px;">
&lt;!-- HTML --&gt;
&lt;div class="nautiljon-search-widget"&gt;
    &lt;label&gt;üîç Search Manga on Nautiljon:&lt;/label&gt;
    &lt;input type="text" id="manga-search" placeholder="Enter manga title..."&gt;
    &lt;button onclick="searchManga()"&gt;Search&lt;/button&gt;
    &lt;div id="search-results"&gt;&lt;/div&gt;
&lt;/div&gt;

// JavaScript
async function searchManga() {
    const query = document.getElementById('manga-search').value;
    const results = await NautiljonAPI.searchManga(query);
    
    let html = '&lt;div class="nautiljon-search-results"&gt;';
    results.forEach(result => {
        html += `
            &lt;div class="result-item"&gt;
                &lt;div class="result-title"&gt;${result.title}&lt;/div&gt;
                &lt;div class="result-url"&gt;${result.url}&lt;/div&gt;
            &lt;/div&gt;
        `;
    });
    html += '&lt;/div&gt;';
    
    document.getElementById('search-results').innerHTML = html;
}
        </div>
    </div>

    <!-- Example 2: Info Card -->
    <div class="container section">
        <h2>üìö Example 2: Nautiljon Info Card</h2>
        <p>Display detailed manga information in a beautiful card:</p>
        
        <div id="info-card-container"></div>

        <div class="code" style="margin-top: 15px;">
// Load and display manga info
async function displayMangaInfo() {
    const info = await NautiljonAPI.getMangaInfo("One Piece");
    const container = document.getElementById('info-card-container');
    NautiljonAPI.displayInfoCard(info, container);
}

// Call on page load
displayMangaInfo();
        </div>
    </div>

    <!-- Example 3: Series Details with Nautiljon -->
    <div class="container section">
        <h2>üéØ Example 3: Series Details with Nautiljon Data</h2>
        <p>Display series details including Nautiljon information:</p>
        
        <button class="btn-enrichment" onclick="exampleLoadSeries()">
            üìñ Load Series Details
        </button>
        <div id="series-details" style="margin-top: 20px;"></div>

        <div class="code" style="margin-top: 15px;">
async function loadSeriesDetails(seriesId) {
    const series = await NautiljonAPI.getSeriesWithNautiljon(seriesId);
    
    let html = `
        &lt;div&gt;
            &lt;h3&gt;${series.title}&lt;/h3&gt;
            &lt;p&gt;Library: ${series.library.name}&lt;/p&gt;
            &lt;p&gt;Local Volumes: ${series.total_volumes}&lt;/p&gt;
    `;
    
    // Display Nautiljon data
    if (series.nautiljon && series.nautiljon.url) {
        NautiljonAPI.displayInfoCard(series.nautiljon, 
            document.getElementById('info-container'));
    }
    
    document.getElementById('series-details').innerHTML = html;
}
        </div>
    </div>

    <!-- Example 4: Enrichment Button -->
    <div class="container section">
        <h2>‚ú® Example 4: Series Enrichment</h2>
        <p>Add Nautiljon data to an existing series:</p>
        
        <button class="btn-enrichment" onclick="exampleEnrichSeries()">
            üîç Enrich This Series with Nautiljon
        </button>
        <div id="enrichment-result" style="margin-top: 15px;"></div>

        <div class="code" style="margin-top: 15px;">
async function enrichSeriesWithNautiljon(seriesId, seriesTitle) {
    const result = await NautiljonAPI.enrichSeries(
        seriesId,
        seriesTitle,
        'title'  // search by title
    );
    
    if (result.success) {
        console.log('Enrichment successful!', result.info);
        // Refresh UI to show new data
    } else {
        console.error('Enrichment failed:', result.error);
    }
}
        </div>
    </div>

    <!-- Example 5: Batch Enrichment -->
    <div class="container section">
        <h2>‚ö° Example 5: Batch Enrichment</h2>
        <p>Enrich multiple series at once with progress tracking:</p>
        
        <button class="btn-enrichment" onclick="exampleBatchEnrich()">
            üöÄ Batch Enrich Library
        </button>

        <div class="code" style="margin-top: 15px;">
async function batchEnrichLibrary(libraryId) {
    // Get all series in library
    const response = await fetch(`/api/library/${libraryId}/series`);
    const series = await response.json();
    const seriesIds = series.map(s => s.id);
    
    // Show progress and enrich
    const results = await NautiljonAPI.showEnrichmentProgress(seriesIds);
    
    console.log(`Enriched ${results.succeeded}/${results.total} series`);
}
        </div>
    </div>

    <!-- Example 6: Scan with Auto-Enrich -->
    <div class="container section">
        <h2>üé® Example 6: Scan with Auto-Enrichment</h2>
        <p>Scan a library and automatically enrich all detected series:</p>
        
        <button class="btn-enrichment" onclick="exampleScanAndEnrich()">
            üìÇ Scan & Auto-Enrich Library
        </button>

        <div class="code" style="margin-top: 15px;">
async function scanLibraryWithEnrichment(libraryId) {
    const response = await fetch(`/api/scan/${libraryId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ auto_enrich: true })
    });
    
    const result = await response.json();
    
    if (result.success) {
        console.log(`Scanned ${result.series_count} series`);
        console.log('All series enriched with Nautiljon data!');
    }
}
        </div>
    </div>

    <!-- API Reference -->
    <div class="container section">
        <h2>üìö API Reference</h2>
        
        <h3>Nautiljon.searchManga(query)</h3>
        <div class="code">
/**
 * Search for a manga on Nautiljon
 * @param {string} query - Manga title to search
 * @returns {Promise&lt;Array&gt;} Array of search results
 */
const results = await NautiljonAPI.searchManga("One Piece");
// [{title: "One Piece", url: "..."}]
        </div>

        <h3>Nautiljon.getMangaInfo(urlOrTitle, byUrl)</h3>
        <div class="code">
/**
 * Get detailed info for a manga
 * @param {string} urlOrTitle - Nautiljon URL or manga title
 * @param {boolean} byUrl - If true, treat input as URL
 * @returns {Promise&lt;Object&gt;} Manga information
 */
const info = await NautiljonAPI.getMangaInfo("One Piece");
// {
//   title: "One Piece",
//   total_volumes: 108,
//   french_volumes: 107,
//   editor: "Gl√©nat",
//   status: "En cours",
//   ...
// }
        </div>

        <h3>Nautiljon.enrichSeries(seriesId, searchValue, searchBy)</h3>
        <div class="code">
/**
 * Enrich a series with Nautiljon data
 * @param {number} seriesId - Series ID to enrich
 * @param {string} searchValue - Title or URL to search for
 * @param {string} searchBy - 'title' or 'url'
 * @returns {Promise&lt;Object&gt;} Enrichment result
 */
const result = await NautiljonAPI.enrichSeries(1, "One Piece", "title");
        </div>

        <h3>Nautiljon.batchEnrichSeries(seriesIds, searchBy)</h3>
        <div class="code">
/**
 * Batch enrich multiple series
 * @param {Array&lt;number&gt;} seriesIds - Array of series IDs
 * @param {string} searchBy - 'title' or 'url' (default: 'title')
 * @returns {Promise&lt;Object&gt;} Batch result with succeeded/failed counts
 */
const result = await NautiljonAPI.batchEnrichSeries([1, 2, 3, 4, 5]);
        </div>

        <h3>Nautiljon.displayInfoCard(nautiljonData, container)</h3>
        <div class="code">
/**
 * Display Nautiljon info card (built-in styling)
 * @param {Object} nautiljonData - Nautiljon information object
 * @param {HTMLElement} container - DOM element to insert into
 */
NautiljonAPI.displayInfoCard(info, document.getElementById('card-container'));
        </div>
    </div>

    <!-- Tips & Best Practices -->
    <div class="container section">
        <h2>üí° Tips & Best Practices</h2>
        
        <h3>1. Error Handling</h3>
        <div class="code">
try {
    const info = await NautiljonAPI.getMangaInfo("manga-title");
    if (!info) {
        console.warn("Manga not found on Nautiljon");
        // Show fallback UI or ask user to search manually
    }
} catch (error) {
    console.error("Nautiljon API error:", error);
    // Handle network errors gracefully
}
        </div>

        <h3>2. Caching Results</h3>
        <div class="code">
// NautiljonAPI already caches results automatically
// Subsequent requests for the same manga will be instant

const info1 = await NautiljonAPI.getMangaInfo("One Piece");  // Slow first time
const info2 = await NautiljonAPI.getMangaInfo("One Piece");  // Instant (cached)
        </div>

        <h3>3. User Feedback</h3>
        <div class="code">
async function enrichWithFeedback(seriesId, title) {
    const btn = event.target;
    const originalText = btn.textContent;
    
    btn.disabled = true;
    btn.textContent = "‚è≥ Enriching...";
    
    try {
        const result = await NautiljonAPI.enrichSeries(seriesId, title, "title");
        if (result.success) {
            btn.textContent = "‚úÖ Done!";
            setTimeout(() => btn.textContent = originalText, 2000);
        }
    } finally {
        btn.disabled = false;
    }
}
        </div>
    </div>

    <script src="/static/js/nautiljon.js"></script>
    <script>
        // Example functions
        async function exampleSearch() {
            const query = document.getElementById('manga-search').value;
            const results = await NautiljonAPI.searchManga(query);
            
            if (!results.length) {
                document.getElementById('search-results').innerHTML = 
                    '<p>No results found</p>';
                return;
            }
            
            let html = '<div class="nautiljon-search-results">';
            results.forEach(result => {
                html += `
                    <div class="result-item" onclick="selectResult('${result.url}')">
                        <div class="result-title">${result.title}</div>
                        <div class="result-url">${result.url}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            document.getElementById('search-results').innerHTML = html;
        }

        async function exampleLoadSeries() {
            const series = {
                id: 1,
                title: "One Piece",
                total_volumes: 50,
                library: { name: "My Library" },
                nautiljon: {
                    total_volumes: 108,
                    french_volumes: 107,
                    editor: "Gl√©nat",
                    status: "En cours",
                    mangaka: "Oda Eiichiro",
                    year_start: 1997,
                    year_end: null,
                    url: "https://www.nautiljon.com/manga/one-piece.html"
                }
            };
            
            let html = `
                <h3>${series.title}</h3>
                <p><strong>Library:</strong> ${series.library.name}</p>
                <p><strong>Local Volumes:</strong> ${series.total_volumes}</p>
            `;
            
            document.getElementById('series-details').innerHTML = html;
            
            // Show Nautiljon info
            const container = document.createElement('div');
            document.getElementById('series-details').appendChild(container);
            NautiljonAPI.displayInfoCard(series.nautiljon, container);
        }

        async function exampleEnrichSeries() {
            const result = document.getElementById('enrichment-result');
            result.innerHTML = '<p>‚è≥ Enriching series...</p>';
            
            // Simulate enrichment
            setTimeout(() => {
                result.innerHTML = `
                    <div style="background: #d4edda; padding: 12px; border-radius: 6px; color: #155724; border: 1px solid #c3e6cb;">
                        ‚úÖ <strong>Enrichment successful!</strong><br>
                        Found on Nautiljon: One Piece (108 volumes)<br>
                        French Edition: 107 volumes by Gl√©nat
                    </div>
                `;
            }, 1000);
        }

        async function exampleBatchEnrich() {
            await NautiljonAPI.showEnrichmentProgress([1, 2, 3, 4, 5]);
        }

        async function exampleScanAndEnrich() {
            const result = document.createElement('div');
            result.style.marginTop = '20px';
            document.querySelector('.btn-enrichment:last-of-type').after(result);
            
            result.innerHTML = '<p>‚è≥ Scanning library and enriching series...</p>';
            
            setTimeout(() => {
                result.innerHTML = `
                    <div style="background: #d4edda; padding: 12px; border-radius: 6px; color: #155724; border: 1px solid #c3e6cb;">
                        ‚úÖ <strong>Scan complete!</strong><br>
                        Found: 15 series<br>
                        Enriched: 14 series with Nautiljon data<br>
                        Failed: 1 series (not found)
                    </div>
                `;
            }, 1500);
        }

        // Initial example
        async function initExample() {
            const info = await NautiljonAPI.getMangaInfo("One Piece");
            if (info) {
                NautiljonAPI.displayInfoCard(info, 
                    document.getElementById('info-card-container'));
            }
        }

        // Run on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initExample);
        } else {
            initExample();
        }
    </script>
</body>
</html>
