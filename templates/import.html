<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import de Mangas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Navigation verticale -->
        <div class="sidebar-nav">
            <a href="/" class="nav-link">ğŸ“š BibliothÃ¨ques</a>
            <a href="/import" class="nav-link active">ğŸ“¥ Import</a>
            <a href="/discover" class="nav-link">ğŸ¯ DÃ©couvrir</a>
            <a href="/search" class="nav-link">ğŸ” Recherche</a>
            <a href="/transfer" class="nav-link">â†”ï¸ Transfer</a>
            <a href="/nautiljon" class="nav-link">ğŸŒŠ Nautiljon</a>
            <a href="/missing-monitor" class="nav-link">ğŸ“Š Surveillance</a>
            <a href="/settings" class="nav-link">âš™ï¸ Configuration</a>
        </div>

        <div class="main-wrapper">
            <header>
                <div class="header-content">
                    <div class="header-left">
                        <h1>ğŸ“¥ Import de Mangas</h1>
                        <p class="subtitle">Scannez et importez vos nouveaux mangas</p>
                    </div>
                </div>
            </header>

            <div class="content-wrapper">
                <div class="content">
            <!-- SÃ©lection du rÃ©pertoire d'import -->
            <div class="import-section">
                <h2>RÃ©pertoire d'import</h2>
                <div class="import-path-selector">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="import-path" class="import-path-input" 
                               placeholder="/chemin/vers/dossier/import">
                        <button type="button" class="btn btn-success" onclick="scanImportDirectory()">ğŸ” Scanner</button>
                    </div>
                    <input type="file" id="import-folder-browser" webkitdirectory directory multiple 
                           style="display: none;" onchange="handleImportFolderSelect(event)">
                    <small style="color: #666; margin-top: 8px; display: block;">ğŸ’¡ Le chemin est automatiquement mÃ©morisÃ© pour la prochaine fois</small>
                </div>
            </div>

            <!-- Zone de rÃ©sultats du scan -->
            <div id="scan-results" style="display: none;">
                <div class="import-stats">
                    <div class="stat-card">
                        <div class="stat-label">Fichiers trouvÃ©s</div>
                        <div class="stat-value" id="files-found">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Correspondances</div>
                        <div class="stat-value" id="matches-found">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Non assignÃ©s</div>
                        <div class="stat-value" id="unassigned-count">0</div>
                    </div>
                </div>

                <!-- Actions globales -->
                <div class="import-actions">
                    <button class="btn" onclick="autoMatchAll()">ğŸ¯ Auto-assignation</button>
                    <button class="btn" onclick="cleanupEmptyDirectories()" style="background: #f59e0b;">ğŸ§¹ Nettoyer rÃ©pertoires vides</button>
                    <button class="btn btn-success" onclick="executeImport()" id="import-btn" disabled>
                        âœ… Importer les fichiers sÃ©lectionnÃ©s
                    </button>
                    <button class="btn" onclick="clearImport()">ğŸ—‘ï¸ Effacer</button>
                </div>

                <!-- Liste des fichiers Ã  importer -->
                <div id="import-files-container">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Scan en cours...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de sÃ©lection de sÃ©rie/bibliothÃ¨que -->
    <div class="modal" id="select-destination-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeDestinationModal()">Ã—</span>
            <h2 class="modal-title">SÃ©lectionner la destination</h2>
            <p class="modal-subtitle" id="file-to-assign">Fichier: ...</p>
            
            <div class="destination-selector">
                <div class="form-group">
                    <label>BibliothÃ¨que</label>
                    <select id="destination-library" onchange="loadLibrarySeries()">
                        <option value="">-- SÃ©lectionner une bibliothÃ¨que --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>SÃ©rie</label>
                    <select id="destination-series">
                        <option value="">-- SÃ©lectionner une sÃ©rie --</option>
                        <option value="__new__">â• CrÃ©er une nouvelle sÃ©rie</option>
                    </select>
                </div>

                <div class="form-group" id="new-series-name-group" style="display: none;">
                    <label>Nom de la nouvelle sÃ©rie</label>
                    <input type="text" id="new-series-name" placeholder="Nom de la sÃ©rie">
                </div>

                <div class="form-actions">
                    <button class="btn" onclick="closeDestinationModal()">Annuler</button>
                    <button class="btn btn-success" onclick="assignDestination()">Valider</button>
                </div>
            </div>
        </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/import.js') }}"></script>
    <script src="{{ url_for('static', filename='js/nav.js') }}"></script>
</body>
</html>
